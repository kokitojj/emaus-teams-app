# Dockerfile.dev
# Imagen base ligera (Alpine) + compatibilidad glibc para lightningcss
FROM node:20-alpine

# 1) Requisitos en Alpine (lightningcss y amigos)
RUN apk add --no-cache libc6-compat openssl

# 2) Directorio de trabajo
WORKDIR /app

# 3) Instala dependencias con optional deps (necesarias para lightningcss)
COPY package*.json ./
RUN npm ci --include=optional

# 4) Genera Prisma (si usas Prisma)
#    Copiamos solo la carpeta prisma para que se cachee bien esta capa
COPY prisma ./prisma
RUN npx prisma generate

# 5) Copia el resto del código (después de instalar deps para cache óptimo)
COPY . .

# 6) Variables útiles en dev
ENV HOST=0.0.0.0
ENV PORT=3003
ENV NEXT_TELEMETRY_DISABLED=1

# 7) Puerto dev
EXPOSE 3003

# 8) Arranque en modo dev, accesible desde fuera del contenedor
CMD ["npm", "run", "dev", "--", "-p", "3003", "-H", "0.0.0.0"]
