// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Modelo de Trabajador (ahora como Usuario)
model Worker {
  id              String       @id @default(uuid())
  username        String       @unique
  email           String?      @unique
  password        String
  phoneNumber     String?
  role            String       @default("empleado")
  status          String       @default("activo")
  leaveRequests   LeaveRequest[]
  // Relacionamos los trabajadores con los tipos de tareas que pueden realizar
  taskTypes       TaskType[]
  // Relacionamos los trabajadores con las tareas que tienen asignadas
  assignedTasks   Task[]
}

// Nuevo: Modelo para Tipos de Tareas
model TaskType {
  id              String       @id @default(uuid())
  name            String       @unique
  // Relacionamos los tipos de tareas con los trabajadores que pueden realizarlas
  qualifiedWorkers Worker[]
  // Relacionamos los tipos de tareas con las tareas creadas
  tasks           Task[]
}

// Modelo de Tarea
model Task {
  id               String       @id @default(uuid())
  name             String
  isCompleted      Boolean      @default(false)
  // Conectamos la tarea a un trabajador asignado
  assignedWorker   Worker       @relation(fields: [assignedWorkerId], references: [id])
  assignedWorkerId String
  // Conectamos la tarea a su tipo de tarea
  taskType         TaskType     @relation(fields: [taskTypeId], references: [id])
  taskTypeId       String
}

// Modelo de Solicitud de vacaciones o permiso
model LeaveRequest {
  id               String   @id @default(uuid())
  type             String
  startDate        DateTime
  endDate          DateTime
  reason           String?
  status           String   @default("pendiente")
  worker           Worker   @relation(fields: [workerId], references: [id])
  workerId         String
  supervisorId     String?
}